<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Export a Table to PDF Template | PrepBootstrap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="font-awesome/css/font-awesome.min.css" />

    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>
    <!--
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
    -->
    <script type="text/javascript" src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.6.3/papaparse.min.js"></script>
    <style>
        .pdfobject-container { height: 500px;}
        .pdfobject { border: 1px solid #666; }
    </style>
</head>

<body>

<div class="container">
<br>
<div class="page-header">
    <h1>ST071 FE Schedule</h1>
</div>
<br>
<!-- Export a Table to PDF - START -->
<link rel="stylesheet" type="text/css" href="font-awesome/css/font-awesome.min.css" />
<link rel="stylesheet" type="text/css" href="css/styles.css" />

<div class="container" style="padding:10px 10px;">
    <form class="form-inline">
        <div class="form-group">
            <button type="submit" id="submit-file" class="btn btn-lg btn-space clearfix" style="background:#3399ff;color:white">
                <span class="fa fa-upload"></span> Load File
            </button>
        </div>
        <div class="form-group">
            <label for="files"> </label>
            <input type="file" id="files" class="form-control" accept=".csv" required />
        </div>
    </form>
    <br>

    <button id="exportButton" class="btn btn-lg btn-space btn-danger clearfix">
        <span class="fa fa-file-pdf-o"></span> Export to PDF
    </button>
    <br>
    <br>
    <div id="header"></div>
    <div class="well">
        <div class="row" id="parsed_csv_list" style="height:500px;overflow: scroll;">
        </div>
    </div>
</div>

<!-- you need to include the shieldui css and js assets in order for the components to work 
<link rel="stylesheet" type="text/css" href="http://www.shieldui.com/shared/components/latest/css/light/all.min.css" />
<script type="text/javascript" src="http://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>
<script type="text/javascript" src="http://www.shieldui.com/shared/components/latest/js/jszip.min.js"></script>
-->

<!--
<script type="text/javascript">
    $('#submit-file').on("click",function(e){
        e.preventDefault();
        $(document).ready(function(){
            var data;
            var theFile = document.getElementById('files');
            var fileName = theFile.value.split(/(\\|\/)/g).pop();
        
            $.ajax({
                type: "GET",
                //url: "SampleCSVFile.csv",
                url: fileName,
                dataType: "text",
                success: function(response)
                {
                    data = $.csv.toArrays(response);
                    generateHtmlTable(data);
                }
            });

            function generateHtmlTable(data) {
                var html = '<table class="table table-condensed table-hover table-striped">';
            
                if(typeof(data[0]) === 'undefined') {
                    return null;
                } else {
                    $.each(data, function( index, row ) {
                        //bind header
                        if(index == 0) {
                            html += '<thead>';
                            html += '<tr>';
                            $.each(row, function( index, colData ) {
                                html += '<th>';
                                html += colData;
                                html += '</th>';
                            });
                            html += '</tr>';
                            html += '</thead>';
                            html += '<tbody>';
                        } else {
                            html += '<tr>';
                            $.each(row, function( index, colData ) {
                                html += '<td>';
                                html += colData;
                                html += '</td>';
                            });
                            html += '</tr>';
                        }
                    });
                    html += '</tbody>';
                    html += '</table>';

                    $('#csv-display').append(html);
                }
            }
        });
    });
</script>
-->

<script type="text/javascript">
    $(document).ready(function(){
      
      $('#submit-file').on("click",function(e){
          e.preventDefault();
          $('#files').parse({
              config: {
                  delimiter: "auto",
                  complete: displayHTMLTable,
              },
              before: function(file, inputElem)
              {
                  //console.log("Parsing file...", file);
              },
              error: function(err, file)
              {
                  //console.log("ERROR:", err, file);
              },
              complete: function()
              {
                  //console.log("Done with all files");
              }
          });
      });
      
      function displayHTMLTable(results){
          var table = '<table id="exportTable" class="table table-condensed table-hover table-striped">';
          var data = results.data;
           
          for(i=0;i<data.length;i++){
              table+= "<tr>";
              var row = data[i];
              var cells = row.join(",").split(",");
               
              for(j=0;j<cells.length;j++){
                  table+= "<td>";
                  table+= cells[j];
                  table+= "</th>";
              }
              table+= "</tr>";
          }
          table+= "</table>";
          $("#parsed_csv_list").html(table);
      }
    });
</script>

<script type="text/javascript">
    jQuery(function ($) {
        $("#exportButton").click(function () {
            var sTable = document.getElementById('parsed_csv_list').innerHTML;

            var style = "<style>";
            style = style + "table {width: 100%;font: 17px Calibri;}";
            style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
            style = style + "padding: 12px 14px;text-align: center;}";
            style = style + "</style>";

            // CREATE A WINDOW OBJECT.
            var win = window.open('', '', 'height=700,width=700');
            win.document.write('<html><head>');
            //win.document.write('<title>Schedule</title>');   // <title> FOR PDF HEADER.
            win.document.write(style);          // ADD STYLE INSIDE THE HEAD TAG.
            win.document.write('</head>');
            win.document.write('<body>');
            win.document.write(sTable);         // THE TABLE CONTENTS INSIDE THE BODY TAG.
            win.document.write('</body></html>');

            win.document.close(); 	// CLOSE THE CURRENT WINDOW.

            win.print();    // PRINT THE CONTENTS.
        });  
    });
</script>

<!--
<script type="text/javascript">
    jQuery(function ($) {
        $("#exportButton").click(function () {
            // parse the HTML table element having an id=exportTable
            var dataSource = shield.DataSource.create({
                data: "#exportTable",
                schema: {
                    type: "table",
                    fields: {
                        Name: { type: String },
                        Age: { type: Number },
                        Email: { type: String }
                    }
                }
            });
        

            // when parsing is done, export the data to PDF
            dataSource.read().then(function (data) {
                var pdf = new shield.exp.PDFDocument({
                    author: "PrepBootstrap",
                    created: new Date()
                });

                pdf.addPage("a4", "portrait");

                pdf.table(
                    50,
                    50,
                    data,
                    [
                        { field: "Name", title: "First Name", width: 200 },
                        { field: "Age", title: "Age", width: 50 },
                        { field: "Email", title: "Email Address", width: 200 }
                    ],
                    {
                        margins: {
                            top: 50,
                            left: 50
                        }
                    }
                );

                pdf.saveAs({
                    fileName: "PrepPDF"
                });
            });
        });
    });
</script>
-->

<style>
    #exportButton {
        border-radius: 0;
    }
</style>

<!-- Export a Table to PDF - END -->

</div>

</body>
</html>